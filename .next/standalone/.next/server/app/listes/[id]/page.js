(()=>{var e={};e.id=139,e.ids=[139],e.modules={247:(e,t,r)=>{"use strict";r.r(t),r.d(t,{GlobalError:()=>i.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c});var s=r(5239),a=r(8088),n=r(8170),i=r.n(n),l=r(893),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(t,o);let c={children:["",{children:["listes",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,9431)),"C:\\Users\\mthsm\\Documents\\Relay\\Relay-PWA\\src\\app\\listes\\[id]\\page.jsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,9769)),"C:\\Users\\mthsm\\Documents\\Relay\\Relay-PWA\\src\\app\\layout.jsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,7398,23)),"next/dist/client/components/not-found-error"],forbidden:[()=>Promise.resolve().then(r.t.bind(r,9999,23)),"next/dist/client/components/forbidden-error"],unauthorized:[()=>Promise.resolve().then(r.t.bind(r,5284,23)),"next/dist/client/components/unauthorized-error"]}]}.children,d=["C:\\Users\\mthsm\\Documents\\Relay\\Relay-PWA\\src\\app\\listes\\[id]\\page.jsx"],u={require:r,loadChunk:()=>Promise.resolve()},p=new s.AppPageRouteModule({definition:{kind:a.RouteKind.APP_PAGE,page:"/listes/[id]/page",pathname:"/listes/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},515:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>h});var s=r(687);r(3609);var a=r(3210),n=r(6189),i=r(5216),l=r(4798);r(2610);var o=r(3270),c=r(5107),d=r(1172),u=r(8920),p=r(5249);function x({onSupp:e,onEdit:t,isEditing:r,isValidated:n,onPrint:i}){let[l,o]=(0,a.useState)(!1);return(0,s.jsxs)("div",{className:"fixed bottom-6 right-6 z-50 flex flex-col items-center gap-3",children:[(0,s.jsx)(u.N,{children:l&&(0,s.jsxs)(p.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.3},className:"flex flex-col items-center gap-3 mb-2",children:[(0,s.jsx)(p.P.button,{whileTap:{scale:.9},onClick:t,className:"w-12 h-12 rounded-full C-bg-red C-text-white flex items-center justify-center shadow-lg",children:(0,s.jsx)("i",{className:`fas ${r?"fa-check":"fa-pen"}`,"aria-hidden":"true"})}),(0,s.jsx)(p.P.button,{whileTap:{scale:.9},onClick:()=>{o(!1),n()},className:"w-12 h-12 rounded-full C-bg-red C-text-white flex items-center justify-center shadow-lg",children:(0,s.jsx)("i",{className:"fas fa-check-double","aria-hidden":"true"})}),(0,s.jsx)(p.P.button,{whileTap:{scale:.9},onClick:()=>{o(!1),i()},className:"w-12 h-12 rounded-full C-bg-red C-text-white flex items-center justify-center shadow-lg",children:(0,s.jsx)("i",{className:"fas fa-print","aria-hidden":"true"})}),(0,s.jsx)(p.P.button,{whileTap:{scale:.9},onClick:()=>{o(!1),e()},className:"w-12 h-12 rounded-full C-bg-red C-text-white flex items-center justify-center shadow-lg",children:(0,s.jsx)("i",{className:"fas fa-trash","aria-hidden":"true"})})]})}),(0,s.jsx)(p.P.button,{onClick:()=>o(e=>!e),whileTap:{scale:.9},animate:{rotate:135*!!l},transition:{type:"spring",stiffness:260,damping:20},className:"w-16 h-16 rounded-full C-bg-red C-text-white text-3xl flex items-center justify-center shadow-xl",children:(0,s.jsx)("i",{className:"fas fa-plus","aria-hidden":"true"})})]})}function h(){let[e,t]=(0,a.useState)(!1),[r,u]=(0,a.useState)(null),[p,h]=(0,a.useState)([]),[m,f]=(0,a.useState)([]),[b,y]=(0,a.useState)({}),{user:j}=(0,i.A)(),g=(0,n.useParams)(),w=(0,n.useRouter)();g.id;let _=e=>{f(t=>({...t,[e]:!t[e]}))},N=(e,t,r)=>{let s=b[e]??0,a=parseInt(t)*r+s%r;y(t=>({...t,[e]:a}))},v=(e,t,r)=>{let s=Math.floor((b[e]??0)/r)*r+parseInt(t);y(t=>({...t,[e]:s}))},I=async()=>{e&&(0,l.cd)(r.ID_list,b),t(!e)},D=async()=>{let e=await (0,o.yW)(j.ID_store),t=[];r.product_lists.forEach(r=>{let s=b[r.ID_product]??r.Quantity,a=Math.floor(s/r.product.Box_quantity),n=e.find(e=>e.ID_product===r.ID_product);1===r.product.Packing&&(s=a>0?n.Quantity:n.Quantity-1),n&&t.push({ID_product:r.ID_product,Quantity:Math.max(n.Quantity-s,0),Nmb_boxes:Math.max(n.Nmb_boxes-a,0)})}),t.length>0&&await (0,o.NI)(j.ID_store,t),await (0,l.I)(r.ID_list),w.push("/listes")},C=async()=>{await (0,l.I)(r.ID_list),w.push("/listes")},P=async()=>{window.print()},k=e=>{let t=new Date(e),r=String(t.getDate()).padStart(2,"0"),s=String(t.getMonth()+1).padStart(2,"0"),a=t.getFullYear(),n=String(t.getHours()).padStart(2,"0"),i=String(t.getMinutes()).padStart(2,"0");return`Liste du ${r}/${s}/${a} \xe0 ${n}h${i}`};return r&&p?(0,s.jsxs)("div",{className:"flex flex-col gap-3 items-center justify-start relative z-10 w-[100%] h-[100%] p-5",children:[(0,s.jsx)("div",{className:"w-[100%]",children:(0,s.jsx)(c.A,{path:"/listes"})}),(0,s.jsx)(x,{onSupp:C,onEdit:I,isEditing:e,isValidated:D,onPrint:P}),(0,s.jsx)("h2",{className:"text-center text-xl font-bold mb-4",children:k(r.created_at)}),p.map(t=>{let a=r.product_lists.filter(e=>e.product?.ID_category===t.ID_category);return 0===a.length?null:(0,s.jsxs)("div",{className:"mb-6 w-full",children:[(0,s.jsx)("h3",{className:"text-xl mb-2",children:t.category?.Label}),(0,s.jsx)(d.A,{}),(0,s.jsx)("div",{className:"flex flex-col sm:flex-wrap sm:flex-row sm:justify-around gap-2 justify-start items-center w-full mt-3",children:a.map(t=>(0,s.jsxs)("div",{className:"mb-1 flex w-[100%] sm:w-[40%] gap-5 rounded justify-around items-center",children:[(0,s.jsx)("div",{className:"w-[10%]",children:(0,s.jsxs)("label",{className:"relative inline-flex items-center gap-3 cursor-pointer",children:[(0,s.jsx)("input",{type:"checkbox",checked:m[t.ID_product]||!1,onChange:()=>_(t.ID_product),className:"sr-only"}),(0,s.jsx)("div",{className:`w-[8vw] h-[8vw] C-border-red sm:w-[3vw] sm:h-[3vw] rounded-xl border-2 flex items-center justify-center transition-all duration-200 ${m[t.ID_product]?"C-bg-red ":""}`,children:m[t.ID_product]&&(0,s.jsx)("div",{className:"w-3 h-3 rounded-full bg-white"})})]})}),(0,s.jsx)("div",{className:"w-[90%] flex justify-between items-center",children:(0,s.jsxs)("div",{className:`bg-white flex h-[7vh] w-full rounded-[10px] border-[2px] C-border-red mb-2 overflow-hidden transition-all duration-300 ${m[t.ID_product]?"line-through opacity-60":""}`,children:[(0,s.jsxs)("div",{className:"flex w-[60%]",children:[(0,s.jsx)("div",{className:"flex items-center justify-center h-full gap-3 border-r-black border-r-[1px] w-[30%]",children:(0,s.jsx)("img",{src:!t.product.Image||"/images/elements/default-product.jpg",alt:t.product?.Label,className:"w-auto h-full rounded-[10px] object-cover"})}),(0,s.jsx)("div",{className:"flex justify-between items-center w-[70%] h-full py-3 px-2 pr-4",children:(0,s.jsxs)("div",{className:"w-[30%]",children:[(0,s.jsx)("p",{className:"C-text-black font-semibold text-xl",children:t.product?.Label}),(0,s.jsx)("p",{className:"C-text-black font-normal text-sm",children:t.product?.Barcode})]})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-3 sm:gap-5 text-lg pr-4 justify-center w-[40%]",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("i",{className:"fa-solid fa-box C-text-red text-2xl"}),e?(0,s.jsx)("input",{type:"number",value:Math.floor(b[t.ID_product]/t.product.Box_quantity),onChange:e=>N(t.ID_product,e.target.value,t.product.Box_quantity),className:"w-[50px] text-center border border-gray-300 rounded C-text-black font-bold"}):(0,s.jsx)("p",{className:"C-text-black font-bold ",children:Math.floor(b[t.ID_product]/t.product.Box_quantity)})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)("i",{className:"fa-solid fa-dolly C-text-red text-2xl"}),0===t.product.Packing?e?(0,s.jsx)("input",{type:"number",value:b[t.ID_product]%t.product.Box_quantity,onChange:e=>v(t.ID_product,e.target.value,t.product.Box_quantity),className:"w-[50px] text-center border border-gray-300 rounded C-text-black font-bold"}):(0,s.jsx)("span",{className:"C-text-black font-bold",children:Math.round((b[t.ID_product]??t.Quantity)%t.product.Box_quantity)}):(0,s.jsx)("div",{className:"w-[6vw] h-[6vw] sm:w-[2vw] sm:h-[2vw] rounded-lg border-2 flex items-center justify-center transition-all duration-200 C-bg-red C-border-red",children:(0,s.jsx)("div",{className:"w-3 h-3 rounded-full bg-white"})})]})]})]})})]},t.ID_product))})]},t.ID_category)}),(0,s.jsxs)("div",{className:"print-area hidden-print",children:[(0,s.jsx)("h2",{className:"text-center text-xl font-bold mb-4 print-title",children:k(r.created_at)}),(0,s.jsxs)("table",{className:"print-table",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{children:"Produit"}),(0,s.jsx)("th",{children:"Code-barre"}),(0,s.jsx)("th",{children:"Bo\xeetes"}),(0,s.jsx)("th",{children:"Unit\xe9s"})]})}),(0,s.jsx)("tbody",{children:r.product_lists.map(e=>(0,s.jsxs)("tr",{children:[(0,s.jsx)("td",{children:e.product?.Label}),(0,s.jsx)("td",{children:e.product?.Barcode}),(0,s.jsx)("td",{children:Math.floor(e.Quantity/e.product.Box_quantity)}),(0,s.jsx)("td",{children:1===e.product.Packing?(0,s.jsx)("span",{className:"C-text-black font-bold",children:"âœ—"}):Math.floor(e.Quantity%e.product.Box_quantity)})]},e.ID_product))})]})]})]}):null}},846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1172:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});var s=r(687);function a(){return(0,s.jsx)("div",{className:"h-[1px] w-[100%] C-bg-red-var2"})}},2610:(e,t,r)=>{"use strict";r.d(t,{b:()=>a});let{fetchData:s}=r(2744);async function a(e){try{let t=await s(`/categoryEnable/${e}`,{method:"GET"});return await t}catch(e){return null}}},3033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},3270:(e,t,r)=>{"use strict";r.d(t,{NI:()=>n,yW:()=>a,yb:()=>l});let{fetchData:s}=r(2744);async function a(e){try{let t=await s(`/stock/${e}`,{method:"GET"});return console.log("Stocks:",t),await t}catch(e){return null}}async function n(e,t){try{let r=await s(`/stocks/${e}`,{method:"PUT",body:JSON.stringify({stocks:t})});return await r}catch(e){return null}}async function i(e){try{let t=await s("/stocks",{method:"POST",body:JSON.stringify({stocks:e})});return await t}catch(e){return null}}async function l(e,t){try{let r=await a(e),s={};r.forEach(e=>{s[e.ID_product]=e});let l=[],o=[];return t.forEach(t=>{let r=parseInt(t.Quantity)*t.Box_quantity,a=s[t.ID_product];a?0===t.Packing?l.push({ID_product:t.ID_product,Quantity:a.Quantity+r,Nmb_boxes:a.Nmb_boxes+parseInt(t.Quantity),Nmb_on_shelves:a.Nmb_on_shelves}):l.push({ID_product:t.ID_product,Quantity:a.Quantity,Nmb_boxes:a.Nmb_boxes+parseInt(t.Quantity),Nmb_on_shelves:a.Nmb_on_shelves}):0===t.Packing?o.push({ID_product:t.ID_product,ID_store:e,Quantity:r,Nmb_boxes:parseInt(t.Quantity),Nmb_on_shelves:0}):o.push({ID_product:t.ID_product,ID_store:e,Quantity:0,Nmb_boxes:parseInt(t.Quantity),Nmb_on_shelves:0})}),l.length>0&&await n(e,l),o.length>0&&await i(o),await a(e)}catch(e){return console.error("Erreur lors de l'ajout au stock :",e),null}}},3295:e=>{"use strict";e.exports=require("next/dist/server/app-render/after-task-async-storage.external.js")},3548:(e,t,r)=>{Promise.resolve().then(r.bind(r,515))},3609:()=>{},3873:e=>{"use strict";e.exports=require("path")},4798:(e,t,r)=>{"use strict";r.d(t,{Bv:()=>n,D1:()=>i,I:()=>o,JR:()=>a,cd:()=>l});let{fetchData:s}=r(2744);async function a(e){try{let t=await s(`/list/${e}`,{method:"GET"});return await t}catch(e){return null}}async function n(e,t){try{let r=await s(`/list/${e}/${t}`,{method:"GET"});return await r}catch(e){return null}}async function i(e,t){let r={ID_store:e,products:Object.entries(t=Object.fromEntries(Object.entries(t).filter(([e,t])=>t.items>0&&"N/A"!==t.items))).map(([e,t])=>({ID_product:parseInt(e),Quantity:t.items}))};try{console.log("Creating list with data:",r);let e=await s("/list",{method:"POST",body:JSON.stringify(r)});return await e}catch(e){return console.log("Error creating list:",e),null}}async function l(e,t){try{t=Object.fromEntries(Object.entries(t).filter(([e,t])=>t>0&&"N/A"!==t));let r=Object.entries(t).map(([e,t])=>({ID_product:parseInt(e),Quantity:t})),a=await s("/list",{method:"PUT",body:JSON.stringify({ID_list:e,products:r})});return await a}catch(e){return console.log("Error updating list:",e),null}}async function o(e){try{let t=await s("/list",{method:"DELETE",body:JSON.stringify({ID_list:e})});return await t}catch(e){return null}}},5107:(e,t,r)=>{"use strict";r.d(t,{A:()=>i});var s=r(687),a=r(5814),n=r.n(a);function i({path:e}){return(0,s.jsx)("div",{children:(0,s.jsx)(n(),{href:e,className:"p-4",children:(0,s.jsx)("i",{className:"fa-solid fa-arrow-left-long text-3xl C-text-black","aria-hidden":"true"})})})}},7468:(e,t,r)=>{Promise.resolve().then(r.bind(r,9431))},9121:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},9431:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>s});let s=(0,r(2907).registerClientReference)(function(){throw Error("Attempted to call the default export of \"C:\\\\Users\\\\mthsm\\\\Documents\\\\Relay\\\\Relay-PWA\\\\src\\\\app\\\\listes\\\\[id]\\\\page.jsx\" from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.")},"C:\\Users\\mthsm\\Documents\\Relay\\Relay-PWA\\src\\app\\listes\\[id]\\page.jsx","default")}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[108,281],()=>r(247));module.exports=s})();