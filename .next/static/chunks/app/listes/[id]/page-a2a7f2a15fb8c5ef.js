(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[139],{783:(t,e,r)=>{"use strict";r.d(e,{A:()=>l});var a=r(5155),s=r(6874),n=r.n(s);function l(t){let{path:e}=t;return(0,a.jsx)("div",{children:(0,a.jsx)(n(),{href:e,className:"p-4",children:(0,a.jsx)("i",{className:"fa-solid fa-arrow-left-long text-3xl C-text-black","aria-hidden":"true"})})})}},1210:(t,e,r)=>{"use strict";r.d(e,{NI:()=>n,yW:()=>s,yb:()=>i});let{fetchData:a}=r(9360);async function s(t){try{let e=await a("/stock/".concat(t),{method:"GET"});return console.log("Stocks:",e),await e}catch(t){return null}}async function n(t,e){try{let r=await a("/stocks/".concat(t),{method:"PUT",body:JSON.stringify({stocks:e})});return await r}catch(t){return null}}async function l(t){try{let e=await a("/stocks",{method:"POST",body:JSON.stringify({stocks:t})});return await e}catch(t){return null}}async function i(t,e){try{let r=await s(t),a={};r.forEach(t=>{a[t.ID_product]=t});let i=[],c=[];return e.forEach(e=>{let r=parseInt(e.Quantity)*e.Box_quantity,s=a[e.ID_product];s?0===e.Packing?i.push({ID_product:e.ID_product,Quantity:s.Quantity+r,Nmb_boxes:s.Nmb_boxes+parseInt(e.Quantity),Nmb_on_shelves:s.Nmb_on_shelves}):i.push({ID_product:e.ID_product,Quantity:s.Quantity,Nmb_boxes:s.Nmb_boxes+parseInt(e.Quantity),Nmb_on_shelves:s.Nmb_on_shelves}):0===e.Packing?c.push({ID_product:e.ID_product,ID_store:t,Quantity:r,Nmb_boxes:parseInt(e.Quantity),Nmb_on_shelves:0}):c.push({ID_product:e.ID_product,ID_store:t,Quantity:0,Nmb_boxes:parseInt(e.Quantity),Nmb_on_shelves:0})}),i.length>0&&await n(t,i),c.length>0&&await l(c),await s(t)}catch(t){return console.error("Erreur lors de l'ajout au stock :",t),null}}},1756:(t,e,r)=>{"use strict";r.d(e,{b:()=>s});let{fetchData:a}=r(9360);async function s(t){try{let e=await a("/categoryEnable/".concat(t),{method:"GET"});return await e}catch(t){return null}}},2313:(t,e,r)=>{"use strict";r.r(e),r.d(e,{default:()=>f});var a=r(5155);r(7815);var s=r(2115),n=r(5695),l=r(9402),i=r(3008),c=r(1756),o=r(1210),u=r(783),d=r(5068),h=r(760),x=r(6129);function p(t){let{onSupp:e,onEdit:r,isEditing:n,isValidated:l,onPrint:i}=t,[c,o]=(0,s.useState)(!1);return(0,a.jsxs)("div",{className:"fixed bottom-6 right-6 z-50 flex flex-col items-center gap-3",children:[(0,a.jsx)(h.N,{children:c&&(0,a.jsxs)(x.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:20},transition:{duration:.3},className:"flex flex-col items-center gap-3 mb-2",children:[(0,a.jsx)(x.P.button,{whileTap:{scale:.9},onClick:r,className:"w-12 h-12 rounded-full C-bg-red C-text-white flex items-center justify-center shadow-lg",children:(0,a.jsx)("i",{className:"fas ".concat(n?"fa-check":"fa-pen"),"aria-hidden":"true"})}),(0,a.jsx)(x.P.button,{whileTap:{scale:.9},onClick:()=>{o(!1),l()},className:"w-12 h-12 rounded-full C-bg-red C-text-white flex items-center justify-center shadow-lg",children:(0,a.jsx)("i",{className:"fas fa-check-double","aria-hidden":"true"})}),(0,a.jsx)(x.P.button,{whileTap:{scale:.9},onClick:()=>{o(!1),i()},className:"w-12 h-12 rounded-full C-bg-red C-text-white flex items-center justify-center shadow-lg",children:(0,a.jsx)("i",{className:"fas fa-print","aria-hidden":"true"})}),(0,a.jsx)(x.P.button,{whileTap:{scale:.9},onClick:()=>{o(!1),e()},className:"w-12 h-12 rounded-full C-bg-red C-text-white flex items-center justify-center shadow-lg",children:(0,a.jsx)("i",{className:"fas fa-trash","aria-hidden":"true"})})]})}),(0,a.jsx)(x.P.button,{onClick:()=>o(t=>!t),whileTap:{scale:.9},animate:{rotate:135*!!c},transition:{type:"spring",stiffness:260,damping:20},className:"w-16 h-16 rounded-full C-bg-red C-text-white text-3xl flex items-center justify-center shadow-xl",children:(0,a.jsx)("i",{className:"fas fa-plus","aria-hidden":"true"})})]})}function f(){let[t,e]=(0,s.useState)(!1),[r,h]=(0,s.useState)(null),[x,f]=(0,s.useState)([]),[m,y]=(0,s.useState)([]),[b,w]=(0,s.useState)({}),{user:j}=(0,l.A)(),g=(0,n.useParams)(),_=(0,n.useRouter)(),v=g.id;(0,s.useEffect)(()=>{(async()=>{if(null==j?void 0:j.ID_store){let t=await (0,i.Bv)(j.ID_store,v),e=await (0,c.b)(j.ID_store);h(t),f(e),y(Array(t.product_lists.length).fill(!1));let r={};t.product_lists.forEach(t=>{r[t.ID_product]=t.Quantity}),w(r)}})()},[j]);let N=t=>{y(e=>({...e,[t]:!e[t]}))},I=(t,e,r)=>{var a;let s=null!==(a=b[t])&&void 0!==a?a:0,n=parseInt(e)*r+s%r;w(e=>({...e,[t]:n}))},D=(t,e,r)=>{var a;let s=Math.floor((null!==(a=b[t])&&void 0!==a?a:0)/r)*r+parseInt(e);w(e=>({...e,[t]:s}))},C=async()=>{t&&(0,i.cd)(r.ID_list,b),e(!t)},k=async()=>{let t=await (0,o.yW)(j.ID_store),e=[];r.product_lists.forEach(r=>{var a;let s=null!==(a=b[r.ID_product])&&void 0!==a?a:r.Quantity,n=Math.floor(s/r.product.Box_quantity),l=t.find(t=>t.ID_product===r.ID_product);1===r.product.Packing&&(s=n>0?l.Quantity:l.Quantity-1),l&&e.push({ID_product:r.ID_product,Quantity:Math.max(l.Quantity-s,0),Nmb_boxes:Math.max(l.Nmb_boxes-n,0)})}),e.length>0&&await (0,o.NI)(j.ID_store,e),await (0,i.I)(r.ID_list),_.push("/listes")},S=async()=>{await (0,i.I)(r.ID_list),_.push("/listes")},E=async()=>{window.print()},P=t=>{let e=new Date(t),r=String(e.getDate()).padStart(2,"0"),a=String(e.getMonth()+1).padStart(2,"0"),s=e.getFullYear(),n=String(e.getHours()).padStart(2,"0"),l=String(e.getMinutes()).padStart(2,"0");return"Liste du ".concat(r,"/").concat(a,"/").concat(s," \xe0 ").concat(n,"h").concat(l)};return r&&x?(0,a.jsxs)("div",{className:"flex flex-col gap-3 items-center justify-start relative z-10 w-[100%] h-[100%] p-5",children:[(0,a.jsx)("div",{className:"w-[100%]",children:(0,a.jsx)(u.A,{path:"/listes"})}),(0,a.jsx)(p,{onSupp:S,onEdit:C,isEditing:t,isValidated:k,onPrint:E}),(0,a.jsx)("h2",{className:"text-center text-xl font-bold mb-4",children:P(r.created_at)}),x.map(e=>{var s;let n=r.product_lists.filter(t=>{var r;return(null===(r=t.product)||void 0===r?void 0:r.ID_category)===e.ID_category});return 0===n.length?null:(0,a.jsxs)("div",{className:"mb-6 w-full",children:[(0,a.jsx)("h3",{className:"text-xl mb-2",children:null===(s=e.category)||void 0===s?void 0:s.Label}),(0,a.jsx)(d.A,{}),(0,a.jsx)("div",{className:"flex flex-col sm:flex-wrap sm:flex-row sm:justify-around gap-2 justify-start items-center w-full mt-3",children:n.map(e=>{var r,s,n,l;return(0,a.jsxs)("div",{className:"mb-1 flex w-[100%] sm:w-[40%] gap-5 rounded justify-around items-center",children:[(0,a.jsx)("div",{className:"w-[10%]",children:(0,a.jsxs)("label",{className:"relative inline-flex items-center gap-3 cursor-pointer",children:[(0,a.jsx)("input",{type:"checkbox",checked:m[e.ID_product]||!1,onChange:()=>N(e.ID_product),className:"sr-only"}),(0,a.jsx)("div",{className:"w-[8vw] h-[8vw] C-border-red sm:w-[3vw] sm:h-[3vw] rounded-xl border-2 flex items-center justify-center transition-all duration-200 ".concat(m[e.ID_product]?"C-bg-red ":""),children:m[e.ID_product]&&(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-white"})})]})}),(0,a.jsx)("div",{className:"w-[90%] flex justify-between items-center",children:(0,a.jsxs)("div",{className:"bg-white flex h-[7vh] w-full rounded-[10px] border-[2px] C-border-red mb-2 overflow-hidden transition-all duration-300 ".concat(m[e.ID_product]?"line-through opacity-60":""),children:[(0,a.jsxs)("div",{className:"flex w-[60%]",children:[(0,a.jsx)("div",{className:"flex items-center justify-center h-full gap-3 border-r-black border-r-[1px] w-[30%]",children:(0,a.jsx)("img",{src:!e.product.Image||"/images/elements/default-product.jpg",alt:null===(r=e.product)||void 0===r?void 0:r.Label,className:"w-auto h-full rounded-[10px] object-cover"})}),(0,a.jsx)("div",{className:"flex justify-between items-center w-[70%] h-full py-3 px-2 pr-4",children:(0,a.jsxs)("div",{className:"w-[30%]",children:[(0,a.jsx)("p",{className:"C-text-black font-semibold text-xl",children:null===(s=e.product)||void 0===s?void 0:s.Label}),(0,a.jsx)("p",{className:"C-text-black font-normal text-sm",children:null===(n=e.product)||void 0===n?void 0:n.Barcode})]})})]}),(0,a.jsxs)("div",{className:"flex items-center gap-3 sm:gap-5 text-lg pr-4 justify-center w-[40%]",children:[(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("i",{className:"fa-solid fa-box C-text-red text-2xl"}),t?(0,a.jsx)("input",{type:"number",value:Math.floor(b[e.ID_product]/e.product.Box_quantity),onChange:t=>I(e.ID_product,t.target.value,e.product.Box_quantity),className:"w-[50px] text-center border border-gray-300 rounded C-text-black font-bold"}):(0,a.jsx)("p",{className:"C-text-black font-bold ",children:Math.floor(b[e.ID_product]/e.product.Box_quantity)})]}),(0,a.jsxs)("div",{className:"flex items-center gap-1",children:[(0,a.jsx)("i",{className:"fa-solid fa-dolly C-text-red text-2xl"}),0===e.product.Packing?t?(0,a.jsx)("input",{type:"number",value:b[e.ID_product]%e.product.Box_quantity,onChange:t=>D(e.ID_product,t.target.value,e.product.Box_quantity),className:"w-[50px] text-center border border-gray-300 rounded C-text-black font-bold"}):(0,a.jsx)("span",{className:"C-text-black font-bold",children:Math.round((null!==(l=b[e.ID_product])&&void 0!==l?l:e.Quantity)%e.product.Box_quantity)}):(0,a.jsx)("div",{className:"w-[6vw] h-[6vw] sm:w-[2vw] sm:h-[2vw] rounded-lg border-2 flex items-center justify-center transition-all duration-200 C-bg-red C-border-red",children:(0,a.jsx)("div",{className:"w-3 h-3 rounded-full bg-white"})})]})]})]})})]},e.ID_product)})})]},e.ID_category)}),(0,a.jsxs)("div",{className:"print-area hidden-print",children:[(0,a.jsx)("h2",{className:"text-center text-xl font-bold mb-4 print-title",children:P(r.created_at)}),(0,a.jsxs)("table",{className:"print-table",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"Produit"}),(0,a.jsx)("th",{children:"Code-barre"}),(0,a.jsx)("th",{children:"Bo\xeetes"}),(0,a.jsx)("th",{children:"Unit\xe9s"})]})}),(0,a.jsx)("tbody",{children:r.product_lists.map(t=>{var e,r;return(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:null===(e=t.product)||void 0===e?void 0:e.Label}),(0,a.jsx)("td",{children:null===(r=t.product)||void 0===r?void 0:r.Barcode}),(0,a.jsx)("td",{children:Math.floor(t.Quantity/t.product.Box_quantity)}),(0,a.jsx)("td",{children:1===t.product.Packing?(0,a.jsx)("span",{className:"C-text-black font-bold",children:"✗"}):Math.floor(t.Quantity%t.product.Box_quantity)})]},t.ID_product)})})]})]})]}):null}},3008:(t,e,r)=>{"use strict";r.d(e,{Bv:()=>n,D1:()=>l,I:()=>c,JR:()=>s,cd:()=>i});let{fetchData:a}=r(9360);async function s(t){try{let e=await a("/list/".concat(t),{method:"GET"});return await e}catch(t){return null}}async function n(t,e){try{let r=await a("/list/".concat(t,"/").concat(e),{method:"GET"});return await r}catch(t){return null}}async function l(t,e){let r={ID_store:t,products:Object.entries(e=Object.fromEntries(Object.entries(e).filter(t=>{let[e,r]=t;return r.items>0&&"N/A"!==r.items}))).map(t=>{let[e,r]=t;return{ID_product:parseInt(e),Quantity:r.items}})};try{console.log("Creating list with data:",r);let t=await a("/list",{method:"POST",body:JSON.stringify(r)});return await t}catch(t){return console.log("Error creating list:",t),null}}async function i(t,e){try{e=Object.fromEntries(Object.entries(e).filter(t=>{let[e,r]=t;return r>0&&"N/A"!==r}));let r=Object.entries(e).map(t=>{let[e,r]=t;return{ID_product:parseInt(e),Quantity:r}}),s=await a("/list",{method:"PUT",body:JSON.stringify({ID_list:t,products:r})});return await s}catch(t){return console.log("Error updating list:",t),null}}async function c(t){try{let e=await a("/list",{method:"DELETE",body:JSON.stringify({ID_list:t})});return await e}catch(t){return null}}},4212:(t,e,r)=>{Promise.resolve().then(r.bind(r,2313))},5068:(t,e,r)=>{"use strict";r.d(e,{A:()=>s});var a=r(5155);function s(){return(0,a.jsx)("div",{className:"h-[1px] w-[100%] C-bg-red-var2"})}},7815:()=>{},9142:(t,e,r)=>{"use strict";r.d(e,{O5:()=>i,QF:()=>o,c4:()=>c,iD:()=>l});var a=r(7383);let{fetchData:s}=r(9360),n="auth_token";async function l(t,e){try{let r=await s("/login",{method:"POST",body:JSON.stringify({Name:t,Password:e})});return i(r.token),await r}catch(t){return null}}function i(t){a.A.set(n,t,{expires:1,sameSite:"Strict"}),a.A.set("pendingProducts",[])}function c(){return a.A.get(n)}function o(){a.A.remove(n)}},9360:(t,e,r)=>{"use strict";r.r(e),r.d(e,{fetchData:()=>s});var a=r(9142);async function s(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let r=(0,a.c4)(),s=await fetch("".concat("http://127.0.0.1:8000/api").concat(t),{...e,headers:{"Content-Type":"application/json",Accept:"application/json",Authorization:r?"Bearer ".concat(r):""},credentials:"include"});if(!s.ok)throw Error("Erreur HTTP! Statut: ".concat(s.status));return s.json()}catch(t){return null}}},9402:(t,e,r)=>{"use strict";r.d(e,{A:()=>o,O:()=>c});var a=r(5155),s=r(2115),n=r(9142),l=r(5695);let i=(0,s.createContext)();function c(t){let{children:e}=t,[r,c]=(0,s.useState)(null),[o,u]=(0,s.useState)((0,n.c4)()),d=(0,l.useRouter)();(0,s.useEffect)(()=>{{let t=localStorage.getItem("user");t&&c(JSON.parse(t))}},[]),(0,s.useEffect)(()=>{o||d.push("/login")},[o]);let h=async(t,e)=>{let r=await (0,n.iD)(t,e);r&&r.token&&((0,n.O5)(r.token),c(r.user),u(r.token),localStorage.setItem("user",JSON.stringify(r.user)),d.push("/"))};return(0,a.jsx)(i.Provider,{value:{user:r,token:o,login:h,logout:()=>{(0,n.QF)(),c(null),u(null),localStorage.removeItem("user"),d.push("/login")}},children:e})}function o(){return(0,s.useContext)(i)}}},t=>{var e=e=>t(t.s=e);t.O(0,[726,806,562,441,684,358],()=>e(4212)),_N_E=t.O()}]);